<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soundproofing Calculator</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/surface-details.css') }}">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <script>
        window.APP_STATE = window.APP_STATE || {
            isInitialized: false,
            dependencies: new Set(),
            initializedComponents: new Set(),
            errors: new Map(),
            managers: {}
        };

        window.SOLUTION_CONSTANTS = window.SOLUTION_CONSTANTS || {};
        {{ solution_constants_js|safe }}
        
        window.SOLUTION_CONSTANTS.DIRECTION_LABELS = {
            'north_wall': 'North Wall',
            'south_wall': 'South Wall',
            'east_wall': 'East Wall',
            'west_wall': 'West Wall',
            'ceiling': 'Ceiling',
            'floor': 'Floor'
        };
        window.APP_STATE.dependencies.add('constants');
    </script>

    <script type="module" src="{{ url_for('static', filename='js/main.js') }}"></script>

</head>
<body>
    <div class="dimension-displays">
        <div id="length-display" class="dimension-value">Length: 0.0 m</div>
        <div id="width-display" class="dimension-value">Width: 0.0 m</div>
        <div id="height-display" class="dimension-value">Height: 0.0 m</div>
    </div>
    <button id="debug-button" class="btn btn-sm btn-secondary" style="position: fixed; bottom: 20px; right: 20px; z-index: 9999;">Debug System</button>
    
    <div id="error-container"></div>
    
    <div class="container">
        <header>
            <h1>Soundproofing Calculator</h1>
        </header>

        <main>
            <div class="workflow-container">
                <!-- Progress Bar -->
                <div class="progress-bar-container">
                    <div class="progress-bar">
                        <div class="step-connector"></div>
                        <div class="progress-step active" data-step="0">
                            <div class="step-number">1</div>
                            <div class="step-label">Room Details</div>
                        </div>
                        <div class="step-connector"></div>
                        <div class="progress-step" data-step="1">
                            <div class="step-number">2</div>
                            <div class="step-label">Noise Details</div>
                        </div>
                        <div class="step-connector"></div>
                        <div class="progress-step" data-step="2">
                            <div class="step-number">3</div>
                            <div class="step-label">Surface Details</div>
                        </div>
                        <div class="step-connector"></div>
                        <div class="progress-step" data-step="3">
                            <div class="step-number">4</div>
                            <div class="step-label">Review</div>
                        </div>
                    </div>
                </div>
                <!-- Sections Container -->
                <div class="sections-container">
                    <!-- Room Details Section -->
                    <section id="room-details" class="section active">
                        <div class="section-header">
                            <h2>Room Details</h2>
                            <p class="section-description">Enter the dimensions of your room</p>
                        </div>
                        <div class="room-details-container">
                            <form id="room-dimensions-form">
                                <!-- Room Dimensions Section -->
                                <div class="form-section">
                                    <h3>Room Dimensions</h3>
                                    <div class="room-inputs">
                                        <input type="number" id="room-length" data-room-detail="length" min="0" step="0.1" required>
                                        <input type="number" id="room-width" data-room-detail="width" min="0" step="0.1" required>
                                        <input type="number" id="room-height" data-room-detail="height" min="0" step="0.1" required>
                                        <select id="room-type" data-room-detail="type" required>
                                            <option value="">Select Room Type</option>
                                            <option value="bedroom">Bedroom</option>
                                            <option value="living">Living Room</option>
                                            <option value="office">Office</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Area Calculations -->
                                <div class="area-calculations">
                                    <div class="area-item">
                                        <div class="area-label">Wall Area</div>
                                        <div class="area-value"><span id="wall-area">0</span> m²</div>
                                    </div>
                                    <div class="area-item">
                                        <div class="area-label">Floor Area</div>
                                        <div class="area-value"><span id="floor-area">0</span> m²</div>
                                    </div>
                                    <div class="area-item">
                                        <div class="area-label">Ceiling Area</div>
                                        <div class="area-value"><span id="ceiling-area">0</span> m²</div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </section>

                    <!-- Noise Details Section -->
                    <section id="noise-details" class="section">
                        <div class="section-header">
                            <h2>Noise Details</h2>
                            <p class="section-description">Describe the noise you want to reduce</p>
                        </div>

                        <!-- Noise Type Selection -->
                        <div class="form-group">
                            <label for="noise-type">Type of Noise</label>
                            <select id="noise-type" required>
                                <option value="">Select noise type</option>
                                <option value="speech">Speech/Voices</option>
                                <option value="music">Music/Bass</option>
                                <option value="machinery">Machinery/Equipment</option>
                                <option value="impact">Impact Noise</option>
                                <option value="footsteps">Footsteps</option>
                                <option value="mixed">Multiple Sources</option>
                            </select>
                        </div>

                        <!-- Noise Intensity -->
                        <div class="form-group">
                            <label for="noise-intensity">Noise Intensity (1-10)</label>
                            <input type="range" id="noise-intensity" min="1" max="10" value="5">
                            <span id="intensity-value">5</span>
                        </div>

                        <!-- Noise Direction -->
                        <div class="form-group">
                            <label>When does the noise occur?</label>
                            <div class="checkbox-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" name="noise-time" value="morning">
                                    <span>Morning</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="noise-time" value="afternoon">
                                    <span>Afternoon</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="noise-time" value="evening">
                                    <span>Evening</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="noise-time" value="night">
                                    <span>Night</span>
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Surface Targeted Treatments</label>
                            <div class="checkbox-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" name="noise-direction" value="ceiling">
                                    <span>Ceiling Treatment</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="noise-direction" value="floor">
                                    <span>Floor Treatment</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="noise-direction" value="north">
                                    <span>North Wall Treatment</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="noise-direction" value="east">
                                    <span>East Wall Treatment</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="noise-direction" value="south">
                                    <span>South Wall Treatment</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="noise-direction" value="west">
                                    <span>West Wall Treatment</span>
                                </label>
                            </div>
                        </div>

                        <!-- Add recommendations section in noise details -->
                        <div class="recommendations-section">
                            <h3>Recommended Solutions</h3>
                            <div id="recommendations-container">
                                <div class="loading-placeholder">
                                    <div class="loading-spinner"></div>
                                    <p>Complete the form to see recommendations</p>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Surface Details Section -->
                    <section id="surface-details" class="section">
                        <div class="section-header">
                            <h2>Surface Features</h2>
                            <p class="section-description">Select features for each surface type</p>
                        </div>
                        
                        <!-- Blockages Section -->
                        <div class="blockages-section">
                            <!-- Wall Blockages -->
                            <div class="blockage-interface">
                                <h3>Wall Blockages</h3>
                                <div class="blockage-stats">
                                    <span>Total Blockages: <strong id="wall-total-blockages">0</strong></span>
                                    <span>Total Area: <strong id="wall-total-blockage-area">0</strong> m²</span>
                                </div>
                                <button type="button" class="btn btn-secondary" id="add-wall-blockage">Add Blockage</button>
                                <div class="blockages-list" id="wall-blockages">
                                    <div id="north-wall-blockages"></div>
                                    <div id="east-wall-blockages"></div>
                                    <div id="south-wall-blockages"></div>
                                    <div id="west-wall-blockages"></div>
                                </div>
                            </div>

                            <!-- Floor Blockages -->
                            <div class="blockage-interface">
                                <h3>Floor Blockages</h3>
                                <div class="blockage-stats">
                                    <span>Total Blockages: <strong id="floor-total-blockages">0</strong></span>
                                    <span>Total Area: <strong id="floor-total-blockage-area">0</strong> m²</span>
                                </div>
                                <button type="button" class="btn btn-secondary" id="add-floor-blockage">Add Blockage</button>
                                <div class="blockages-list" id="floor-blockages"></div>
                            </div>

                            <!-- Ceiling Blockages -->
                            <div class="blockage-interface">
                                <h3>Ceiling Blockages</h3>
                                <div class="blockage-stats">
                                    <span>Total Blockages: <strong id="ceiling-total-blockages">0</strong></span>
                                    <span>Total Area: <strong id="ceiling-total-blockage-area">0</strong> m²</span>
                                </div>
                                <button type="button" class="btn btn-secondary" id="add-ceiling-blockage">Add Blockage</button>
                                <div class="blockages-list" id="ceiling-blockages"></div>
                            </div>
                        </div>

                        <!-- Blockage Modals -->
                        <!-- Wall Blockage Modal -->
                        <div class="modal" id="wall-blockage-modal">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h4>Add Wall Blockage</h4>
                                    <button type="button" class="close-modal">×</button>
                                </div>
                                <div class="modal-body">
                                    <form id="wall-blockage-form">
                                        <div class="form-group">
                                            <label for="wall-blockage-wall">Wall Location</label>
                                            <select id="wall-blockage-wall" name="wall" required>
                                                <option value="">Select Wall</option>
                                                <option value="north">North Wall</option>
                                                <option value="east">East Wall</option>
                                                <option value="south">South Wall</option>
                                                <option value="west">West Wall</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="wall-blockage-type">Type</label>
                                            <select id="wall-blockage-type" name="type" required>
                                                <option value="">Select Type</option>
                                                <optgroup label="Windows">
                                                    <option value="window-standard">Standard Window</option>
                                                    <option value="window-bay">Bay Window</option>
                                                    <option value="window-sash">Sash Window</option>
                                                    <option value="window-dormer">Dormer Window</option>
                                                </optgroup>
                                                <optgroup label="Doors">
                                                    <option value="door-standard">Standard Door</option>
                                                    <option value="door-french">French Doors</option>
                                                    <option value="door-sliding">Sliding Door</option>
                                                    <option value="door-bifold">Bi-fold Door</option>
                                                </optgroup>
                                                <optgroup label="Storage">
                                                    <option value="cupboard-built">Built-in Cupboard</option>
                                                    <option value="cupboard-fitted">Fitted Wardrobe</option>
                                                    <option value="shelving">Shelving Unit</option>
                                                </optgroup>
                                                <optgroup label="Utilities">
                                                    <option value="radiator">Radiator</option>
                                                    <option value="fireplace">Fireplace</option>
                                                    <option value="boiler">Boiler</option>
                                                    <option value="electrical-box">Electrical Box</option>
                                                    <option value="electrical-outlet">Electrical Outlet</option>
                                                </optgroup>
                                                <optgroup label="Structural">
                                                    <option value="pillar">Pillar/Column</option>
                                                    <option value="beam">Supporting Beam</option>
                                                    <option value="boxing">Boxing</option>
                                                    <option value="alcove">Alcove</option>
                                                    <option value="chimney-breast">Chimney Breast</option>
                                                </optgroup>
                                                <option value="other">Other</option>
                                            </select>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label for="wall-blockage-width">Width (m)</label>
                                                <input type="number" id="wall-blockage-width" name="width" step="0.01" min="0" required>
                                            </div>
                                            <div class="form-group">
                                                <label for="wall-blockage-height">Height (m)</label>
                                                <input type="number" id="wall-blockage-height" name="height" step="0.01" min="0" required>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="wall-blockage-notes">Notes (optional)</label>
                                            <textarea id="wall-blockage-notes" name="notes" rows="2"></textarea>
                                        </div>
                                        <div class="form-actions">
                                            <button type="button" class="btn btn-secondary cancel-blockage">Cancel</button>
                                            <button type="submit" class="btn btn-primary">Add Blockage</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- Floor Blockage Modal -->
                        <div class="modal" id="floor-blockage-modal">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h4>Add Floor Blockage</h4>
                                    <button type="button" class="close-modal">×</button>
                                </div>
                                <div class="modal-body">
                                    <form id="floor-blockage-form">
                                        <div class="form-group">
                                            <label for="floor-blockage-type">Type</label>
                                            <select id="floor-blockage-type" name="type" required>
                                                <option value="">Select Type</option>
                                                <optgroup label="Furniture">
                                                    <option value="furniture-cabinet">Cabinet</option>
                                                    <option value="furniture-desk">Desk</option>
                                                    <option value="furniture-table">Table</option>
                                                    <option value="furniture-bed">Bed</option>
                                                    <option value="furniture-sofa">Sofa</option>
                                                    <option value="furniture-bookshelf">Bookshelf</option>
                                                </optgroup>
                                                <optgroup label="Floor Features">
                                                    <option value="floor-vent">Floor Vent</option>
                                                    <option value="floor-drain">Floor Drain</option>
                                                    <option value="floor-hatch">Access Hatch</option>
                                                    <option value="floor-trap">Service Trap</option>
                                                </optgroup>
                                                <optgroup label="Structural">
                                                    <option value="structural-pillar">Support Pillar</option>
                                                    <option value="structural-step">Step/Level Change</option>
                                                    <option value="structural-post">Support Post</option>
                                                </optgroup>
                                                <option value="other">Other</option>
                                            </select>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label for="floor-blockage-width">Width (m)</label>
                                                <input type="number" id="floor-blockage-width" name="width" step="0.01" min="0" required>
                                            </div>
                                            <div class="form-group">
                                                <label for="floor-blockage-length">Length (m)</label>
                                                <input type="number" id="floor-blockage-length" name="length" step="0.01" min="0" required>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="floor-blockage-notes">Notes (optional)</label>
                                            <textarea id="floor-blockage-notes" name="notes" rows="2"></textarea>
                                        </div>
                                        <div class="form-actions">
                                            <button type="button" class="btn btn-secondary cancel-blockage">Cancel</button>
                                            <button type="submit" class="btn btn-primary">Add Blockage</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- Ceiling Blockage Modal -->
                        <div class="modal" id="ceiling-blockage-modal">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h4>Add Ceiling Blockage</h4>
                                    <button type="button" class="close-modal">×</button>
                                </div>
                                <div class="modal-body">
                                    <form id="ceiling-blockage-form">
                                        <div class="form-group">
                                            <label for="ceiling-blockage-type">Type</label>
                                            <select id="ceiling-blockage-type" name="type" required>
                                                <option value="">Select Type</option>
                                                <optgroup label="Lighting">
                                                    <option value="light-pendant">Pendant Light</option>
                                                    <option value="light-chandelier">Chandelier</option>
                                                    <option value="light-spot">Spotlight</option>
                                                    <option value="light-track">Track Lighting</option>
                                                    <option value="light-recessed">Recessed Light</option>
                                                </optgroup>
                                                <optgroup label="Ceiling Features">
                                                    <option value="ceiling-vent">Air Vent</option>
                                                    <option value="ceiling-fan">Ceiling Fan</option>
                                                    <option value="ceiling-speaker">Speaker</option>
                                                    <option value="ceiling-hatch">Access Hatch</option>
                                                    <option value="ceiling-trap">Service Trap</option>
                                                </optgroup>
                                                <optgroup label="Structural">
                                                    <option value="structural-beam">Support Beam</option>
                                                    <option value="structural-duct">Duct Work</option>
                                                    <option value="structural-skylight">Skylight</option>
                                                    <option value="structural-bulkhead">Bulkhead</option>
                                                </optgroup>
                                                <option value="other">Other</option>
                                            </select>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label for="ceiling-blockage-width">Width (m)</label>
                                                <input type="number" id="ceiling-blockage-width" name="width" step="0.01" min="0" required>
                                            </div>
                                            <div class="form-group">
                                                <label for="ceiling-blockage-length">Length (m)</label>
                                                <input type="number" id="ceiling-blockage-length" name="length" step="0.01" min="0" required>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="ceiling-blockage-notes">Notes (optional)</label>
                                            <textarea id="ceiling-blockage-notes" name="notes" rows="2"></textarea>
                                        </div>
                                        <div class="form-actions">
                                            <button type="button" class="btn btn-secondary cancel-blockage">Cancel</button>
                                            <button type="submit" class="btn btn-primary">Add Blockage</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- Surface panels -->
                        <div class="surface-container">
                            <!-- Wall solutions will be loaded here -->
                            <div id="wallSolutionsContainer" class="solutions-panel">
                                <!-- Wall solutions will be loaded here by wall-manager.js -->
                            </div>
                            
                            <!-- Floor Solutions Container -->
                            <div id="floorSolutionsContainer" class="solutions-panel">
                                <!-- Floor solutions will be loaded here by floor-manager.js -->
                            </div>
                            
                            <!-- Ceiling Solutions Container -->
                            <div id="ceilingSolutionsContainer" class="solutions-panel">
                                <!-- Ceiling solutions will be loaded here by ceiling-manager.js -->
                            </div>
                        </div>
                    </section>

                    <!-- Review Section -->
                    <section id="review" class="section">
                        <div class="section-header">
                            <h2>Review</h2>
                            <p class="section-description">Review your selections and get recommendations</p>
                        </div>
                        
                        <!-- Summary recommendations can stay as a separate section -->
                        <div id="summary-recommendations">
                            <div class="recommendations-content">
                                <!-- Summary content will be dynamically inserted here -->
                            </div>
                        </div>
                    </section>

                    <!-- Quote Section -->
                    <section id="quote" class="section">
                        <!-- Content will be dynamically populated by JavaScript -->
                    </section>
                </div>

                <!-- Single navigation buttons for all sections -->
                <div class="workflow-navigation">
                    <button type="button" id="prev-btn" class="btn btn-secondary">Previous</button>
                    <button type="button" id="next-btn" class="btn btn-primary">
                        <span class="button-text">Next</span>
                    </button>
                </div>
            </div>
        </main>
    </div>
</body>
</html>